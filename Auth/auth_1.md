Аутентификация и Авторизация
---
---
**Аутентификация** - идентифицировать пользователя как одного из 
зарегистрированных пользователей в системе.

**Авторизация** - определение владеет ли этот пользователь правами
на доступ определенному контенту.


---
Пользователи
---
В стандартной системе `Django` пользователи `user` представлены в виде
различных типов, среди которых есть супер пользователь `superusers` и
администраторы `staff` в моделях для определения этих прав есть свои
поля.

Атрибутами пользователей по умолчанию является:
`username` `password` `email` `first_name` `last_name`

---
Создание пользователей из программного кода
---
За пользователей отвечает модель `django.contrib.auth.models.User` 
через нее и можно создать нового пользователя, для этого етсь 
вспомогательная функция `create_user`

```python
from django.contrib.auth.models import User

    user = User.objects.create_user('john', 'lennon@thebeatles.com', 'password')
```

---
Создание Суперпользователя
---
Создать суперпользователя с правами допуска в административную часть,
можно при помощи специальной утилиты:

```
python3 manage.py createsuperuser

Username: admin
Email address: admin@example.com
Password: **********
Password (again): *********

Superuser created successfully.
```

Теперь мы имеем допуск в административную часть проекта, войдем в админку
по следующему адресу: http://127.0.0.1:8000/admin/

Войдя в админку сайта мы увидим две категории: Группы и Пользователи,
они определены при помощи `django.contrib.auth` дефолтного приложения в Dj
которое определено по дефолту еще в файле настроек.
И позволяют создавать/редактировать ... пользователей и категории к которым 
они могут принадлежать.

---
Смена паролей в программном коде
---
Пароли хранятся в виде не в чистом виде, а как хэши, существует 2 способа 
смены пароля пользователя, через специальную утилиту и через метод ORM.

Смена через утилиту 

    manage.py changepassword username

Смена через специальны метод `set_password` той же модели, что ответственна
за пользователей в системе.

```python
from django.contrib.auth.models import User

    user = User.objects.get(username='john')
    user.set_password('new password')
    user.save()
```

**! Изменение пароля пользователя автоматически приводит к его
выходу из всех текущих сеансов !**

---
Аутентификация пользователя по его логин / пароль
---
Если у нас имеется `username` `password` пользователя то мы этим 
данным мы можем получить обьект этого пользователя, сделать это можно
используя специальный метод `authenticate` передав в него логин и 
пароль.

Так же можно передать запрос `request` тогда будет произведена проверка
имеет ли пользователь с такими данными доступ к ресурсу.

```python
from django.contrib.auth import authenticate

    user = authenticate(username='sergio', password='123')

    if user is not None:
        # пользователь аутентифицирован (найден по логину, паролю)
    else:
        # льзователь не найден
```
---
Аутентификация в веб-запросах `is_authenticated`
---
В каждом обьекте `request` что представляет собой запрос к серверу,
есть атрибут `user` который содержит в себе обьект пользователя, этот
пользователь связан с запросом.

Этот обьект пользователя есть всегда, если пользователь не аутентифицирован
то обьект будет хранить в себе экземпляр класса `AnonymousUser`

У обьекта пользователя, что представляет собой обьект модели `User`, есть
ряд атрибутов типа `boolean` которые указывают права и возможности этого 
пользователя, по этим атрибутам мы можем отличить является ли пользователь 
аутентифицированным для данного запроса или нет, сделать это можно с помощью
атрибута `is_authenticated`

```python
if request.user.is_authenticated:
    # пользователь аутентифицирован
else:
    # не аутентифицирован
```

---
Как авторизовать и разлогинить пользователя к запросу
---
Каждый запрос связан с пользователем, пользователя можно связать
с запросом, и наоборот разлогинить пользователя отвязать его от запроса,
сделать это можно с помощью модуля `django.contrib.auth` и методов 
`logout` и `login`

```python
from django.contrib.auth import logout, login

    # разлогинить пользователя от запроса, кем бы этот пользователь не был 
    logout(request)
    
    # связать пользователя с запросом
    user = User.objects.get(id=15)
    login(request, user)
```
