PostgreSQL Часть 1
---
---

**Списки тем для изучения :**

1) Асинхронная репликация
2) Репликация
3) Репликация больная тема для MySQL
4) storage engine (подключаемых движков) 
5) рекурсивные запросы
6) наследование таблиц
7) Поддержка конкурентности реализована
   с использованием MVCC (Multiversion Concurrency Control)
8) совместимость с ACID
9) параллельность операций без блокировки при чтении
10) 

---
Разница между СУБД MySQL и PostgreSQL 
---

**ХРАНЕНИЕ ДАННЫХ**

Обе СУБД хранят данные на диске в спец отсортированных файлах, но различается 
только сам способ хранения.

MySQL - это реляционная база данных, в нутри которой есть реализауции нескольких
движков MyISAM, InnoDB, MEMORY, Berkeley DB, каждый движок работает по разному
с таблицами на чтение запись и прочее ...

Postgresql - это объектно реляционная база данных, и работате только с одними
единственным движком `storage engine` тоетсь каждая таблица представлена в виде 
обьекта, также предоставляются специальные обьектные функции для изменения этих 
таблиц-обьектов.

**СТАНДАРТ SQL**

Стандарт SQL разработан в 1986 году.

MySQL - стремится к простоте, и не реализует все возможности стансдартов SQL.

Postgresql - разрабатывается энтузиастами, и стремится к максималььному 
соответствию всем современным стандартам SQL какими бы сложными они не были. 

**ВОЗМОЖНОСТИ ОБРАБОТКИ**

MySQL - сервер MySQL получает запрос, выполняет его и отдает весь ответ клинту.

Postgresql - получает запрос, выполняет его и сохраняет на сервере самого Postgresql,
клиент получает указатель, этот указатель можно сохранить межжду сеансами обращения к
Postgresql, тоесть происходит кеширование полученых данных.

Postgresql - поддерживает наследование таблиц и рекурсивные запросы, поддерживается 
построение индексов сразу для нескольких столбцов таблицы, также можно создавать 
индексы сразу для нескольких столбцов таблицы, и при этом индексы будут разных 
типов, поддерживаются индексы типа:

1) hash
2) b-tree
3) GiST
4) SP-GiST для работы с городами
5) GIN для поиска по тексту
6) BRIN  
7) Bloom

**ПРОИЗВОДИТЕЛЬНОСТЬ**

MySQL - в большинстве случае используется таблицы с движком InnoDB, эта таблица
представляет из себя B-дерево с индексами, что позволяет по этим индексам быстро 
получать данные с диска, но ! MySQL будет быстрее Postgresql только при 
использовании первичного ключа

Postgresql - Вся заголовочная информация таблиц Postgresql находится в оперативной
памяти, а не на диске как у MySQL, записи таблицы сортируются по индексу и по этому
их можно быстро извлекать, в целом Postgresql работает быстрее.

**ТИПЫ ДАННЫХ**

MySQL - поддерживает стандартные типы данных.

Postgresql - типов данных в Postgresql больше и они более разнообразны, также
можно создавать свои собственные типы данных, тоетсь это расширяемая СУБД.

**РАЗРАБОТКА**

Оба проекта имеют открытый исходный код,

MySQL - разрабатывается компанией Oracle, от развития этой СУБД сделано множество 
форков и создано много разных реализаций, одна из которых MariaDB от оригиналььного
разработчика.

Postgresql - разработка началась в университете Беркли, сейчас развивается 
энтузиастами.

---
Пользователи и Роли
---

Показать всех пользователей

    SELECT * FROM pg_user;

Показать все роли в БД

    SELECT * FROM pg_roles;

    или команду
    
    \du

---
 
Создать новую роль 

    CREATE ROLE new_role_name;

Удалить роль, и получить ошибку если такой роли не существует

    DROP ROLE role_name;

Удалить роль если такая роль существует, если ее нет то ошибки не будет 

    DROP ROLE IF EXISTS role_name;

---

Есть дамп в виде файла `sql` его требуется развернуть в БД из файла, сделать
это можно такой командой

    psql -U user -d db_name < dump_file.sql

Дать права пользователю на БД

    GRANT ALL PRIVILEGES ON DATABASE db_name to user_name;

Дать пользователю права супер пользователя

    ALTER USER user_name WITH SUPERUSER;

---

У нас есть ситуация, нам требуется сделать дам БД в виде `sql` файла, в самой БД
есть пользователи, и эти пользователи имеют права на различные действия, мы 
можем выгрузить дамп 2 способами, с сохранением прав и без.

Если права будут сохранены, то нам потребуется создать такого же пользователя в нашей
системе, и выполнять действия от его лица, такие как разворот дампа, нам потребуется
выполнять действия либо под тем же пользователем либо под универсальным пользователем 
`postgres`

Или можно выгрузить БД без сохранения прав пользователей.

Сделать дамп с сохранением прав пользователей

    pg_dump db_name > namebackup.sql

Сделать дамп без сохранения прав пользователей

    pg_dump --no-owner db_name > namebackup.sql


1) Подсказка `psql --help`

2) Исполнить SQL файл `psql -f db.sql -U <user>`

3) Подключение к уже сущест БД `psql -d <DataBase> -U <user>`

4) Переключить учетную запись на БД `sudo -i -u <user>`

5) Выйти из режима работы с PostgreSQL `\q`

6) Зайти в PG д ролью `sudo -u <user> psql`

7) Создание новой БД `sudo -u <user> createdb <DBname>`

8) Показать все БД `\l`

9) Показать под каким пользователем и к какой Бд подключены `\conninfo`

10) Посмотерть все таблицы текущей БД `\dt`

11) Подключаемся к PG под пользователем к нужной БД `sudo -u <user> psql -d <db>`

